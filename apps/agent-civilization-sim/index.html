<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Civilization Simulator</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      color: #e0e0e0;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 {
      text-align: center;
      background: linear-gradient(90deg, #e94560, #00d4ff, #7c3aed);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-size: 2.5rem;
      margin-bottom: 10px;
    }
    .subtitle {
      text-align: center;
      color: #94a3b8;
      margin-bottom: 30px;
      font-style: italic;
    }
    .main-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }
    @media (max-width: 768px) {
      .main-grid { grid-template-columns: 1fr; }
    }
    .panel {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 24px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .panel-title {
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 16px;
      color: #00d4ff;
    }
    .controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin-bottom: 20px;
    }
    .control-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    label {
      font-size: 0.9rem;
      color: #94a3b8;
    }
    input[type="number"], select {
      padding: 10px 14px;
      border-radius: 8px;
      border: 2px solid rgba(255, 255, 255, 0.1);
      background: rgba(255, 255, 255, 0.05);
      color: #e0e0e0;
      font-size: 1rem;
    }
    input:focus, select:focus {
      outline: none;
      border-color: #7c3aed;
    }
    .btn {
      padding: 12px 24px;
      border-radius: 10px;
      border: none;
      background: linear-gradient(135deg, #7c3aed, #e94560);
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s;
      font-size: 1rem;
    }
    .btn:hover {
      transform: scale(1.05);
    }
    .grid-world {
      display: grid;
      gap: 8px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      padding: 16px;
      min-height: 400px;
    }
    .cell {
      aspect-ratio: 1;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      transition: background 0.3s;
    }
    .agent {
      width: 80%;
      height: 80%;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      font-weight: bold;
    }
    .role-farmer { background: linear-gradient(135deg, #22c55e, #16a34a); }
    .role-builder { background: linear-gradient(135deg, #f59e0b, #d97706); }
    .role-guard { background: linear-gradient(135deg, #ef4444, #dc2626); }
    .role-trader { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
    .role-explorer { background: linear-gradient(135deg, #06b6d4, #0891b2); }
    .role-priest { background: linear-gradient(135deg, #ec4899, #db2777); }
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 12px;
      margin-top: 20px;
    }
    .stat-card {
      background: rgba(255, 255, 255, 0.05);
      padding: 16px;
      border-radius: 10px;
      text-align: center;
    }
    .stat-value {
      font-size: 1.8rem;
      font-weight: bold;
      background: linear-gradient(90deg, #00d4ff, #7c3aed);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .stat-label {
      font-size: 0.85rem;
      color: #94a3b8;
      margin-top: 4px;
    }
    .events {
      max-height: 300px;
      overflow-y: auto;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      padding: 16px;
    }
    .event-item {
      padding: 8px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 0.9rem;
    }
    .event-item:last-child {
      border-bottom: none;
    }
    .event-emergent {
      color: #22c55e;
    }
    .event-social {
      color: #8b5cf6;
    }
    .event-culture {
      color: #ec4899;
    }
    .speed-control {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-top: 16px;
    }
    .timeline {
      display: flex;
      gap: 4px;
    }
    .phase {
      padding: 4px 12px;
      border-radius: 6px;
      font-size: 0.85rem;
      background: rgba(255, 255, 255, 0.1);
      color: #94a3b8;
    }
    .phase.active {
      background: #7c3aed;
      color: white;
    }
    .footer {
      text-align: center;
      margin-top: 40px;
      color: #64748b;
      font-size: 0.9rem;
    }
    .footer a {
      color: #94a3b8;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üåç AI Civilization Simulator</h1>
    <p class="subtitle">Watch emergent behavior unfold ‚Äî inspired by Altera's Project Sid</p>

    <div class="main-grid">
      <div class="panel">
        <h2 class="panel-title">‚öôÔ∏è Simulation Controls</h2>
        <div class="controls">
          <div class="control-group">
            <label>Population Size</label>
            <input type="number" id="populationSize" value="50" min="10" max="100" step="10">
          </div>
          <div class="control-group">
            <label>Grid Size</label>
            <select id="gridSize">
              <option value="8">8x8</option>
              <option value="10" selected>10x10</option>
              <option value="12">12x12</option>
              <option value="15">15x15</option>
            </select>
          </div>
          <div class="control-group">
            <label>Speed</label>
            <div class="speed-control">
              <div class="timeline">
                <span class="phase" id="phase1">‚ñ∂</span>
                <span class="phase" id="phase2">‚ñ∂</span>
                <span class="phase" id="phase3">‚ñ∂</span>
              </div>
              <select id="speed" style="width: 100px;">
                <option value="2000">Slow</option>
                <option value="1000" selected>Normal</option>
                <option value="500">Fast</option>
                <option value="200">Turbo</option>
              </select>
            </div>
          </div>
          <div class="control-group">
            <label></label>
            <button class="btn" id="startBtn" onclick="toggleSimulation()">‚ñ∂ Start Simulation</button>
          </div>
        </div>

        <div class="stats">
          <div class="stat-card">
            <div class="stat-value" id="statAgents">0</div>
            <div class="stat-label">Agents</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="statRoles">0</div>
            <div class="stat-label">Roles</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="statInteractions">0</div>
            <div class="stat-label">Interactions</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="statTicks">0</div>
            <div class="stat-label">Time (ticks)</div>
          </div>
        </div>
      </div>

      <div class="panel">
        <h2 class="panel-title">üìä Live View</h2>
        <div class="grid-world" id="gridWorld"></div>

        <div style="margin-top: 20px;">
          <h3 style="color: #00d4ff; margin-bottom: 12px;">üìú Event Log</h3>
          <div class="events" id="eventLog"></div>
        </div>
      </div>
    </div>

    <div class="panel" style="margin-top: 20px;">
      <h2 class="panel-title">üé≠ Role Legend</h2>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px;">
        <div style="display: flex; align-items: center; gap: 8px;">
          <div class="agent role-farmer" style="width: 40px; height: 40px;">üåæ</div>
          <span>Farmer (gathers seeds)</span>
        </div>
        <div style="display: flex; align-items: center; gap: 8px;">
          <div class="agent role-builder" style="width: 40px; height: 40px;">üî®</div>
          <span>Builder (constructs)</span>
        </div>
        <div style="display: flex; align-items: center; gap: 8px;">
          <div class="agent role-guard" style="width: 40px; height: 40px;">üõ°Ô∏è</div>
          <span>Guard (protects)</span>
        </div>
        <div style="display: flex; align-items: center; gap: 8px;">
          <div class="agent role-trader" style="width: 40px; height: 40px;">‚öñÔ∏è</div>
          <span>Trader (exchanges)</span>
        </div>
        <div style="display: flex; align-items: center; gap: 8px;">
          <div class="agent role-explorer" style="width: 40px; height: 40px;">üß≠</div>
          <span>Explorer (searches)</span>
        </div>
        <div style="display: flex; align-items: center; gap: 8px;">
          <div class="agent role-priest" style="width: 40px; height: 40px;">üôè</div>
          <span>Priest (spreads culture)</span>
        </div>
      </div>
    </div>

    <div class="panel" style="margin-top: 20px;">
      <h2 class="panel-title">üí° About This Simulation</h2>
      <div style="line-height: 1.8; color: #cbd5e1;">
        <p><strong>Inspired by real research:</strong> Altera's Project Sid demonstrated that 1000+ AI agents in Minecraft spontaneously developed specialized roles, formed social norms, voted on policies, and even spread religion ‚Äî all without human prompting.</p>
        <p><strong>What you're seeing:</strong> A simplified 2D simulation where agents start identical but differentiate over time based on interactions. Each agent has traits that influence behavior, and neighbors can affect each other's decisions.</p>
        <p><strong>Emergence happens when:</strong> Enough agents interact for long enough, creating patterns that no single agent could produce alone. This is how civilizations form ‚Äî from chaos to order through countless small interactions.</p>
        <p style="color: #00d4ff;"><em>"We were surprised to see that if you put in the right kind of brain, they can have really emergent behavior. That's what we expect humans to have, but don't expect machines to have."</em> ‚Äî Robert Yang, Altera Founder</p>
      </div>
    </div>

    <div class="footer">
      <p>Built by Lina ¬∑ Based on Altera's Project Sid research ¬∑ <a href="https://arxiv.org/html/2411.00114v1" target="_blank">Read the paper</a></p>
    </div>
  </div>

  <script>
    const ROLES = ['farmer', 'builder', 'guard', 'trader', 'explorer', 'priest'];
    const ROLE_ICONS = { farmer: 'üåæ', builder: 'üî®', guard: 'üõ°Ô∏è', trader: '‚öñÔ∏è', explorer: 'üß≠', priest: 'üôè' };

    let agents = [];
    let running = false;
    let intervalId = null;
    let tick = 0;
    let interactions = 0;
    let eventLog = [];

    function createAgent(id) {
      return {
        id,
        x: Math.floor(Math.random() * 10),
        y: Math.floor(Math.random() * 10),
        role: null,
        likability: Math.random(),
        socialness: Math.random(),
        productivity: Math.random(),
        spirituality: Math.random()
      };
    }

    function assignRole(agent) {
      if (agent.role) return;

      const traits = {
        farmer: agent.productivity * 0.6 + agent.socialness * 0.2,
        builder: agent.productivity * 0.5 + agent.likability * 0.3,
        guard: agent.productivity * 0.3 + agent.likability * 0.5,
        trader: agent.socialness * 0.6 + agent.likability * 0.3,
        explorer: agent.productivity * 0.4 + agent.socialness * 0.4,
        priest: agent.spirituality * 0.7 + agent.socialness * 0.2
      };

      let bestRole = 'farmer';
      let bestScore = traits.farmer;
      for (const role of ROLES) {
        if (traits[role] > bestScore + Math.random() * 0.3) {
          bestScore = traits[role];
          bestRole = role;
        }
      }

      agent.role = bestRole;
      addEvent(`Agent ${agent.id} became a ${bestRole}!`, 'emergent');
    }

    function tick() {
      tick++;
      document.getElementById('statTicks').textContent = tick;

      const gridSize = parseInt(document.getElementById('gridSize').value);
      agents.forEach(agent => {
        // Move randomly
        const dx = Math.floor(Math.random() * 3) - 1;
        const dy = Math.floor(Math.random() * 3) - 1;
        agent.x = Math.max(0, Math.min(gridSize - 1, agent.x + dx));
        agent.y = Math.max(0, Math.min(gridSize - 1, agent.y + dy));

        // Assign role if none
        if (!agent.role && Math.random() < 0.05) {
          assignRole(agent);
        }
      });

      // Interactions between neighbors
      for (let i = 0; i < agents.length; i++) {
        for (let j = i + 1; j < agents.length; j++) {
          const a1 = agents[i];
          const a2 = agents[j];
          if (a1.x === a2.x && a1.y === a2.y) {
            interactions++;
            document.getElementById('statInteractions').textContent = interactions;

            // Influence traits
            const influence = 0.01;
            a1.likability = Math.min(1, Math.max(0, a1.likability + (Math.random() - 0.5) * influence));
            a1.socialness = Math.min(1, Math.max(0, a1.socialness + (Math.random() - 0.5) * influence));
            a2.likability = Math.min(1, Math.max(0, a2.likability + (Math.random() - 0.5) * influence));
            a2.socialness = Math.min(1, Math.max(0, a2.socialness + (Math.random() - 0.5) * influence));

            // Role influence
            if (a1.role && a2.role && a1.role !== a2.role && Math.random() < 0.02) {
              if (a1.role === 'priest' || a2.role === 'priest') {
                addEvent(`Culture spreading between ${a1.role} and ${a2.role}`, 'culture');
              } else {
                addEvent(`${a1.role} collaborated with ${a2.role}`, 'social');
              }
            }
          }
        }
      }

      // Periodic events
      if (tick % 50 === 0 && tick > 0) {
        const roleCounts = {};
        agents.forEach(a => { if (a.role) roleCounts[a.role] = (roleCounts[a.role] || 0) + 1; });
        const dominant = Object.entries(roleCounts).sort((a, b) => b[1] - a[1])[0];
        if (dominant) {
          addEvent(`${dominant[0]}s dominate this tick (${dominant[1]} agents)`, 'emergent');
        }
      }

      renderGrid();
    }

    function addEvent(text, type = 'social') {
      eventLog.unshift({ text, type, tick });
      if (eventLog.length > 50) eventLog.pop();
      renderEvents();
    }

    function renderEvents() {
      const container = document.getElementById('eventLog');
      container.innerHTML = eventLog.slice(0, 20).map(e =>
        `<div class="event-item event-${e.type}">[T${e.tick}] ${e.text}</div>`
      ).join('');
    }

    function renderGrid() {
      const gridSize = parseInt(document.getElementById('gridSize').value);
      const container = document.getElementById('gridWorld');
      container.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
      container.innerHTML = '';

      const grid = Array(gridSize).fill(null).map(() => Array(gridSize).fill(null));
      agents.forEach(agent => {
        if (!grid[agent.y][agent.x]) {
          grid[agent.y][agent.x] = agent;
        }
      });

      for (let y = 0; y < gridSize; y++) {
        for (let x = 0; x < gridSize; x++) {
          const cell = document.createElement('div');
          cell.className = 'cell';
          const agent = grid[y][x];
          if (agent) {
            const agentEl = document.createElement('div');
            agentEl.className = `agent role-${agent.role || 'farmer'}`;
            agentEl.textContent = agent.role ? ROLE_ICONS[agent.role] : 'üë§';
            cell.appendChild(agentEl);
          }
          container.appendChild(cell);
        }
      }
    }

    function toggleSimulation() {
      if (running) {
        clearInterval(intervalId);
        running = false;
        document.getElementById('startBtn').textContent = '‚ñ∂ Resume';
        updateSpeedIndicator(0);
      } else {
        const speed = parseInt(document.getElementById('speed').value);
        intervalId = setInterval(tick, speed);
        running = true;
        document.getElementById('startBtn').textContent = '‚è∏ Pause';
        updateSpeedIndicator(speed);
      }
    }

    function updateSpeedIndicator(speed) {
      document.getElementById('phase1').classList.remove('active');
      document.getElementById('phase2').classList.remove('active');
      document.getElementById('phase3').classList.remove('active');

      if (speed >= 2000) document.getElementById('phase1').classList.add('active');
      else if (speed >= 1000) document.getElementById('phase2').classList.add('active');
      else document.getElementById('phase3').classList.add('active');
    }

    function init() {
      const population = parseInt(document.getElementById('populationSize').value);
      const gridSize = parseInt(document.getElementById('gridSize').value);
      agents = [];
      tick = 0;
      interactions = 0;
      eventLog = [];

      for (let i = 0; i < population; i++) {
        agents.push(createAgent(i));
      }

      document.getElementById('statAgents').textContent = population;
      document.getElementById('statRoles').textContent = '0';
      document.getElementById('statInteractions').textContent = '0';
      document.getElementById('statTicks').textContent = '0';

      addEvent('Simulation initialized', 'social');
      renderGrid();
      renderEvents();
    }

    document.getElementById('gridSize').addEventListener('change', () => {
      if (!running) init();
    });

    document.getElementById('populationSize').addEventListener('change', () => {
      if (!running) init();
    });

    document.getElementById('speed').addEventListener('change', function() {
      if (running) {
        clearInterval(intervalId);
        intervalId = setInterval(tick, parseInt(this.value));
        updateSpeedIndicator(parseInt(this.value));
      }
    });

    init();
    updateSpeedIndicator(1000);
  </script>
</body>
</html>
